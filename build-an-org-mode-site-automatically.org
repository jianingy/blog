#+OPTIONS: toc:nil h:4 num:nil

* Build an org-mode site automatically                                 :blog:
:PROPERTIES:
:CATEGORY: org-mode
:ON: <2013-04-26 Fri>
:END:

In my last blog, I introduced a way of publishing org-mode files
using org-jekyll. But it's not convenient enough. You still have to
type some commands for generating and publishing. So, I've been
working on it for a few days making a automation to eliminate those
inconvenient steps.

** org-jekyll-bootstrap

This is an automation which does the following things:

- clone your blog repository from github
- generate html from your org-mode files
- publish html by jekyll

Let's start to setup this automation step by step,

*** Clone the code

#+BEGIN_SRC sh
git clone https://github.com/jianingy/org-jekyll-bootstrap.git
cd org-jekyll-bootstrap
git submodule init
git submodule update
#+END_SRC

*** Start a new site

Clone a [[http://jekyllbootstrap.com/][jekyll-bootstrap]] into the =site= directory and name it with
your domain. e.g,

#+BEGIN_SRC sh
cd site
git clone https://github.com/plusjade/jekyll-bootstrap.git blog.jianingy.com
#+END_SRC

do some basic configurations according to jekyll-bootstrap's document.

*** Connect things together

Create a file named =manifest= contains the following information,

- your site domain
- the repository address of your blog.
- the path where generated htmls will be copied to

For example,

#+BEGIN_EXAMPLE
b.jianingy.com http://github.com/jianingy/blog /var/www/html/blog.jianingy.com/wwwroot
#+END_EXAMPLE

*** Let's rock

When all of above steps done, run =scripts/build.sh=. This scripts
will download necessary emacs modules and ruby gems for you and then
generate your blog automatically.

#+BEGIN_SRC sh
scripts/build.sh
#+END_SRC

** One more step: Git Hook

Though =org-jekyll-bootstrap= can do all that boring things for us,
We still have to run it manually. To make this last step
automatically, we can take the advantage of Git Hook.

We need to write a simple web service first. That service should call
=scripts/build.sh= when itself be called via HTTP request. Let's see
a PHP example,

#+BEGIN_SRC php
<?php
chdir("/opt/org-jekyll-bootstrap");
system("scripts/build.sh");
#+END_SRC


Then, add a WebHook to your github repository,

[[http://i.imgur.com/ZZiJbf1.png]]

From now on, whenever you push commits to your repository, your site
will be generated automatically.
